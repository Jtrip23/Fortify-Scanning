stages:
  - build
  - scan

build_dotnet:
  stage: build
  image: docker:latest
  services:
    - docker:dind
  script:
    - docker run -i --rm -v "$CI_PROJECT_DIR":/app \
        fmk.nexus.onefiserv.net/fmk/dotnet/dotnet-8.0-build:FMK-20250401T173337Z \
        dotnet build

fortify_scan:
  stage: scan
  image: docker:latest
  services:
    - docker:dind
  script:
    - mkdir -p artifacts
    - docker run -i --rm -v "$CI_PROJECT_DIR":/app \
        fmk.nexus.onefiserv.net/fmk/dotnet/dotnet-8.0-build:FMK-20250401T173337Z \
        Start-FortifyScan.ps1 \
          -BuildId "$CI_COMMIT_SHORT_SHA" \
          -Source /app \
          -Application "APMXXXXX" \
          -Version "$CI_COMMIT_REF_NAME" \
          -Token "$FORTIFY_TOKEN" \
          -Email "$FORTIFY_EMAIL" \
          -OutputFolder /app/artifacts \
          -Publish